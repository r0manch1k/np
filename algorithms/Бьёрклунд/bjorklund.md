# Задача о гамильтоновом цикле. Алгоритм Бьёрклунда

_Материал написан студентом Соколовским Романом Вадимовичом из группы Б9123-01.03.02сп и является адаптацией [оригинальной статьи](https://arxiv.org/pdf/1008.0541) Андерса Бьёрклунда 2010 года._

## 1. Введение

**Определение.** _Задача о гамильтоновом цикле_ является задачей определения наличия гамильтонового цикла в заданном графе.

... введение

В статье представлена задача определения _суммы маркированных покрытий графа циклами_ и её сведение к задаче о гамильтоновом цикле. Начнём с необходимых для определения задачи предварительных сведений.

## 2. Предварительные сведения

Рассмотрим _направленный_ граф $D = (V, A)$, где $V$ - множество вершин, а $A$ - множество _арок_ (направленных рёбер).

**Определение.** _Покрытием циклами_ вершин графа $D$ называется подмножетство арок $C \subseteq A$ такое, что каждой вершине $v \in V$ соответствует ровно одна арка $a_{v_1} \in C$, начинающаяся в $v$, и ровно одна арка $a_{v2}$, заканчивающася в $v$.

Рассматриваемые в этой статье графы не имеют _петель_ при вершинах, то есть арок, соединяющих вершину с собой же ($a_{v1} \neq a_{v2}$).

Обозначим $cc(D)$ множество всех покрытий циклами графа $D$ и $hc(D) \subseteq cc(D)$ множество гамильтоновых покрытий циклами графа $D$.

Гамильтоновое покрытие циклами состоит из одного _большого_ цикла, проходящего через все вершины.

Остальные покрытия циклами $cc(D) \\ hc(D)$ назовём негамильтоновыми покрытиями циклами.

Хоть элементы $hc(D)$ формально являются подмножествами арок, мы будем иногда обозначать их $(v_0, v_1, \ldots, v_{n-1})$, имея в виду соответствующие арки $v_i v_{i+1}$ в гамильтоновом цикле.

Обозначим $g : A \twoheadrightarrow B$ _сюрьективное отображение_ $g$ из множетсва $A$ в множество $B$. Также обозначим для этой функции обратную $g^{-1} : B \rightarrow 2^A$, где $2^A$ - всевозможные подмножетсва $A$, то есть $g^{-1}(b) = \{a \in A : g(a) = b\}$.

> **Замечание.** Отображение $g : A \twoheadrightarrow B$ называется _сюрьективным_, если $\forall b \in B \ \exists a \in A :  b = g(a)$.

**Определение.** _Суммой маркированных покрытий циклами_ направленного графа $D = (V, A)$, множества маркировок $L$ и функции $f : A \times 2^L \\ \{ \emptyset \} \rightarrow R$ для кольца $R$ называется

$$
\begin{align}
\Lambda(D, L, f) = \sum_{C \in cc(D)} \sum_{g : L \twoheadrightarrow C} \prod_{a \in C} f(a, g^{-1}(a))
\end{align}
$$

Внутренняя сумма проходит по всевозможным сюрьективным отображениям $g$, что значит $g^{-1}(a)$ всегда является непустым подмножеством маркировок. Также все подмножетсва маркировок у арок попарно непересекающиеся и все вместе покрывают $L$ полностью.

> **Замечание.** Множество $R$ называется _кольцом_, если на нём заданы две бинарные операции: $+$ и $\times$ (сложение и умножение), для которых выполняется _коммутативность сложения_, _ассоциативность сложения_, _существование нейтрального элемента относительно сложения_, _существование противоположного (обратного) элемента относительно сложения_, _ассоциативность умножения_, _дистрибутивность_, то есть минимальный нужный нам набор операций.

### A. Сокращение покрытий циклами в кольце характеристики два

> **Замечание.** _Характеристика_ — числовая величина, используемая в общей алгебре для описания некоторых свойств колец или полей. Для кольца $R$ характеристикой $\mathrm{char}(R)$ называется наименьшее целое $n > 0$ такое, что для каждого элемента $r \in R$ выполняется равенство:
>
> $$
> \underbrace {r+\cdots +r} _{n} = 0,
> $$
>
> а если такого числа не существует, то предполагается $\mathrm{char}(R) = 0$.

Покажем, что можно взять такие направленный граф, кольцо и функцию $f$, что сумма маркированных покрытий циклами будет состоять только из гамильтоновых покрытий, а негамильтоновые покрытия сократятся.

Для этого возьмём в качестве направленного графа _двунаправленный_, то есть для каждой арки $uv$ есть арка противоположного направления $vu$. Во-вторых, пусть кольцо $R$ имеет _характеристику два_. В-третьих, для случайно выбранной зафиксированной вершины графа $s$ возьмём $s$-_ориентированную зеркальную функцию_ $f : A \times 2^L \\ \{\emptyset\} \rightarrow R$ такую, что $\forall Z \subseteq L$ и $\forall v, u \in V : u \neq s, v \neq s$ выполняется $f(uv, Z) = f(vu, Z)$. Это поможет не сокращаться отличающимся только по направлению гамильтоновым покрытиям циклами графа.

Следующая лемма показывает, как исчезают негамильтоновы покрытия циклами, что также означает отсутствие ложных срабатываний в алгоритме.

**Лемма 1.** Дан двухнаправленный граф $D = (V, A)$, конечное множество маркировок $L$ и фиксированная вершина $s \in V$, пусть $f$ - $s$-ориентированная зеркальная функция, отображаемая в кольцо $R$ характеристики два. Тогда

$$
\begin{align}
\Lambda(D, L, f) = \sum_{H \in hc(D)} \sum_{g : L \twoheadrightarrow H} \prod_{a \in H} f(a, g^{-1}(a))
\end{align}
$$

> **Доказательство.** Сумму маркированных покрытий графа циклами можно представить в виде кортежа $(C, g)$, где $C \in cc(D)$ и $g : L \twoheadrightarrow C$. Покажем, что маркированные негамильтоновые покрытия графа могут быть разделены на такие пары, что оба покрытия в одной паре превносят одинаковое слагаемое в сумму. Так как мы работаем в кольце характеристика два, такие слагаемые сокращаются.
>
> Рассмотрим негамильтоновые покрытия $(C, g)$. Определим отображение $M$ следующим образом: $M(C, g) = (C', g')$. Пусть $\textbf{C}$ является первым циклом в покрытии, не проходящим через $s$ (рисунок можно посмотреть в оригинальной статье -> [Figure. 1](https://arxiv.org/pdf/1008.0541)). Такой цикл существует, так как негамильтоновое покрытие состоит минимум из двух циклов, причём все циклы в покрытии не имеют общих вершин. Под первым циклом в покрытии имеется в виду первый в каком-то фиксированном порядке для такого набора циклов. Пусть $C' = C$, но в котором цикл $\textbf{C}$ _направлен в другую сторону_, то есть каждая арка $uv \in \textbf{C}$ заменена противоположной аркой $vu$ в $C'$. Такие арки существуют, так как граф $D$ двунаправленный. В случае, если $\textbf{C}$ состоит только из двух арок, покрытие $C'$ будет идентично $C$ (так как обе арки перейдут друг в друга). Определим функцию $g'^{-1}$ так, чтобы маркировки на арках оставались теми же, то есть $g'^{-1}(uv) = g^{-1}(vu)$ для $\forall uv \in \textbf{C}$. Заметим, что $(C, g) \neq M(C, g)$, а $(C, g) = M(M(C, g))$. Таким образом, $M$ определяет уникальные пары негамильтоновых покрытий.
>
> Так как $f$ является $s$-ориентированной зеркальной функцией, то есть $f(uv, Z) = f(vu, Z)$ для любой арки $uv$, не смежной с $s$ и для любого подмножества $Z \in 2^L \\ \{\emptyset\} $, $(C, g)$ и $(C', g')$ превносят одинаковое слагаемое в сумму в $(1)$ и, следовательно, сокращаются.

### B. Обнаружение гамильтоновых циклов

В предыдущем разделе мы утверждали, что вклады негамильтоновых покрытий циклами в сумму нивелируются при выполнении определенных условий. Для того чтобы это было полезно, нам также необходимо, чтобы
гамильтоновы покрытия не обращались в нуль. С этой целью будет полезно рассматривать элементы $f$ как непостоянные многомерные многочлены от переменных, зависимых от арки и множества меток. В частности, для элементов, смежных со специальной вершиной $s$, $f(su, X)$ и $f(us, X)$ не будут иметь одинаковые переменные для $\forall su, us \in A$. Это гарантирует, что гамильтоновы циклы, ориентированные в противоположных направлениях, будут вносить разные вклады в сумму.

Чтобы определить, является ли полином, полученный в результате записи суммы маркированных покрытий циклами графа, тождественным нулем (=нет гамильтоновых циклов) или нет (=по крайней мере один гамильтонов цикл), мы вычислим полином в случайно выбранной точке. Если результат отличен от нуля, мы точно знаем, что полином не может быть нулевым. Если результат равен нулю, мы предполагаем, что полином также является нулевым. Лемма Шварца-Циппеля гарантирует, что с большой вероятностью мы будем правы.

**Лемма (Шварца-Зиппеля).** Пусть $P(x_1, x_2, \dots, x_n)$ явялется полиномом $n$ переменных с ненулевыми коэффициентами степени $d$ над полем $F$. Пусть $S$ - конечное подмножество $F$ и пусть элементы $r_1, r_2, \ldots, r_n$ были выбраны из $S$ равномерно и независимо друг от друга. Тогда

$$
\mathrm{Pr}(P(r_1, r_2, \ldots, r_n) = 0) \leq \frac{f}{|S|}
$$

Вычисление алгоритма в этой статье будет над конечным полем характеристика два - $GF(2^k)$ для некоторого $k$ после замены переменных на значения.

> **Замечание.** _Конечное поле_ или _поле Галуа_ - поле, состоящее из конечного числа элементов; это число называется _порядком_ поля. Конечное поле обычно обозначается $GF(q)$ (Galios Field). Порядок всегда является степенью какого-нибудь простого числа, то есть $q = p^k$, где $p$ - простое число, а $k$ - любое натуральное число. При этом $p$ будет являться характеристикой этого поля.
>
> Важными для нас свойствами такого поля являются:
>
> - Любое конечное поле $GF(q)$ - кольцо
> - Для любого элемента конечного поля характеристики два выполняется $x + x = 0$
>
> Не следует также путать конечные поля $GF(p^k)$ и [кольца вычетов](https://ru.wikipedia.org/wiki/Конечное_поле#Связь_с_кольцами_вычетов) $Z \\ (p^k)$. Мы рассматриваем в статье первый вариант.
